<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="d3.js"></script>
    <style>
        div.chart{
            font-family:sans-serif;
            font-size:0.7em;
        }
    </style>

    <script>

    function color_by_year(d,i) {
//    console.log(d)
    if(d.id == 2007) {
    return 'Blue';
    }
    else if (d.id == 2008) {
    return 'Red';
    }
    else if (d.id == 2009) {
    return 'Green';
    }
    else if (d.id == 2010) {
    return 'Orange';
    }
    else if (d.id == 2011) {
    return 'Pink';
    }
    else {
    return 'Purple';
    }
    }

    function mk_arcs(data) {
        var pie = d3.layout.pie().value(function(d){return 1;});
        var arcs = pie(data),
                   i = -1,
                   arc;
        while (++i < data.length) {
            arc = arcs[i];
	    arc.innerRadius = 100;
	    arc.outerRadius = 100+10*data[i].count;
	    arc.id = data[i].year;
	}
        return arcs;
    }

    function draw(data) {
        "use strict";
        var margin = 50,
            width = 800,
            height = 800,
            r1 = 400,
            r0 = 200,
            color = d3.scale.category20c();
	console.log(color(25));
        var vis = d3.select("body")
                    .append("svg:svg")
                    .attr('width', width+margin)
		    .attr('height', height+margin)
		    .data([data])
		    .append('svg:g')
		    .attr("transform", "translate(" + r1 + "," + r1 + ")");

        var arc = d3.svg.arc();

        var arcs = vis.selectAll("g.slice")
                      .data(mk_arcs(data))
                      .enter()
                      .append("svg:g")
		      .attr('id', function(d){return d.id});

//                   .attr('class','slice arc_' + function(d){return d.week;});
//                   .attr('id', function(d){return d.week;});


       // I can't assign IDs as above, I need another way
       arcs.append('svg:path')
//           .attr('fill',function(d,i){return color(d.month);})
//           .attr('fill',function(d,i){return color(i);})
           .attr('fill',function(d,i){return color_by_year(d,i)})
           .attr('d',arc);
    } 

    </script>
</head>
<body>
    <script>
        d3.json('data/ring_week.json', draw);
    </script>
</body>
</html>
