<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="d3.js"></script>
    <style>

    .axis path, line{
        stroke:black; }

  .line {
        float:left;
    }

    .line_container{
        width: 150px;
        height: 20px;
    }

    #ring{ float:right; }

    .key{ float:left; }

    .key_line{
        font-size:17px;
        width:100%;
    }
    .key_square{
//background-color:#FCCC0A;
background-color:Yellow;
        height:10px;
        width:10px;
        outline:solid 1px black;
        float:left;
        margin-right:10px;
        margin-top:6px;
        margin-left:10px;
    }

        div.chart{
            font-family:sans-serif;
            font-size:0.7em;
        }
    </style>

    <script>

    function color_by_year(d,i) {
    if(d.id == 2007) {
    return 'Blue';
    }
    else if (d.id == 2008) {
    return 'Red';
    }
    else if (d.id == 2009) {
    return 'Green';
    }
    else if (d.id == 2010) {
    return 'Orange';
    }
    else if (d.id == 2011) {
    return 'Pink';
    }
    else {
    return 'Purple';
    }
    }

    function mk_arcs(data) {
        var pie = d3.layout.pie().value(function(d){return 1;});
        var arcs = pie(data),
                   i = -1,
                   arc;
        while (++i < data.length) {
            arc = arcs[i];
	    arc.innerRadius = 100;
	    arc.outerRadius = 100+10*data[i].count;
	    arc.id = data[i].year;
	    arc.month = data[i].month;
	}
        return arcs;
    }

    function draw(data) {
        "use strict";
        var margin = 50,
            width = 800,
            height = 800,
            r1 = 400,
            r0 = 200,
            color = d3.scale.category20c();
//	console.log(color(25));
        var vis = d3.select("#ring")
                    .append("svg:svg")
                    .attr('width', width+margin)
		    .attr('height', height+margin)
		    .data([data])
		    .append('svg:g')
		    .attr("transform", "translate(" + r1 + "," + r1 + ")");

        var arc = d3.svg.arc();

        var arcs = vis.selectAll("g.slice")
                      .data(mk_arcs(data))
                      .enter()
                      .append("svg:g")
		      .attr('id', function(d){return d.id});

//                   .attr('class','slice arc_' + function(d){return d.week;});
//                   .attr('id', function(d){return d.week;});


       // I can't assign IDs as above, I need another way
       arcs.append('svg:path')
           .attr('fill',function(d,i){return color(d.month);}) // color by month
//           .attr('fill',function(d,i){return color(i);}) // random color
//           .attr('fill',function(d,i){return color_by_year(d,i)}) // color for each year
           .attr('d',arc);

      // draw the key
      var month_data = [1,2,3,4,5,6,7,8,9,10,11,12];
      var key_items = d3.select('#key')
                        .selectAll('div')
                        .data(month_data)
		        .enter()
		        .append('div')
		        .attr('class', 'key_line')
		        .attr('id', function(d){ return 'month' + d; });


<!-- background-color:Yellow; -->
<!--         height:10px; -->
<!--         width:10px; -->
<!--         outline:solid 1px black; -->
<!--         float:left; -->
<!--         margin-right:10px; -->
<!--         margin-top:6px; -->
<!--         margin-left:10px; -->


key_items.append('div')
<!-- .('background-color','Yellow') -->
<!-- .attr('height','10px') -->
<!-- .attr('width','10px') -->
<!-- .attr('float','left') -->
<!-- .attr('margin-left','10px') -->
<!-- .attr('outline','solid 1px black') -->
<!-- .attr('margin-right','10px') -->
<!-- .attr('margin-top','10px') -->

            //.attr('id', function(d,i){return 'key_square_' + d[i]})
.style('background-color', function(d){return color(d);})
            .attr('class', function(d,i){return 'key_square ' + d[i]})

//.attr('stroke', function(d){return color(d);})
//.attr('fill', function(d){return color(d);});
        
        key_items.append('div')
            .attr('class','key_label')
            .text(function(d){ return 'month' + d; })
    } 

    </script>
</head>
<body>
    <div id="key"></div>
    <div id="ring"></div>
    <script>
        d3.json('data/ring_week.json', draw);
    </script>
</body>
</html>
